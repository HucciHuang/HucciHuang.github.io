---
title: 如何用 git 进行版本回滚
date: 2023-11-14 12:00:00 +0800
categories: [git]
tags: [git]
---

这篇文章介绍了如何使用 *git* 进行代码的版本回滚。

## 如何访问节点

无论是哪种，都需要了解怎么访问节点。有两种方式可以访问，一是通过绝对路径，二是通过相对路径。

### 绝对路径

绝对路径即每次 commit 的哈希值，通过 git log 查看。

```bash
git checkout C1 # C1 是简化的哈希值，一般情况下都很长
```

### 相对路径

使用 `^` 和 `~` 来指示要去的地方在 HEAD 上面的第几个节点。

`HEAD^` 是上面一个节点，`HEAD~2` 是上面两个节点。

```bash
git checkout HEAD^ # 回到上一个节点
git checkout HEAD~3 # 回到上 3 个节点
```

HEAD 是一个指向当前所在分支的指针，总是指向当前分支上最近一次提交记录。

## 回滚至历史节点

既然已经找到了想去的节点，剩下的就是会滚到那个节点了。

总体来说有两种方法，一是跳回到历史节点，二是创造一个新提交，但这个提交和历史节点一样。

### 跳回历史节点

要跳回历史节点，可以选择用已有的分支或者创建新的分支。

#### 使已有的分支跳回去

假设想要让 *master* 分支回到 *C1* 节点，可以这样做

```python
git branch master C1 # 让 master 到哈希值为 C1 的节点
```

如果已经处于 *head* 分离，*head* 已经在 *C1* 了，就不用再填写哈希值。**但是要记得移动完分支之后 *checkout* 到分支上，不然会继续处于 head 分离的状态。**

```python
git branch -f master
```

#### 创造新的分支

如果要用新的分支，将上面的 `git branch -f` 换成创建新分支的指令就可以了，这样的指令有很多。

```python
git checkout -b new_branch C1
git branch new_branch C1
git switch -c new_branch C1
```

### 创建一个新 *commit*，但是以前节点

*head* 继续前进，但新的节点是过去的内容。

可以使用 *revert* 命令，也可以使用 *cherry-pick* 。

```bash
git revert C2
git cherry-pick C2
```