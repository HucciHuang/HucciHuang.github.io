---
title: 如何用 git 进行版本回滚
date: 2023-11-14 12:00:00 +0800
categories: [git]
tags: []
pin: false
---

这篇文章介绍了如何使用 *git* 进行代码的版本回滚。

回滚代码有两种途径，一是直接回到历史中，二是创建一个新的 commit with 历史内容。

## 如何访问节点

无论是哪种，都需要了解怎么访问节点。有两种方式可以访问，一是通过绝对路径，二是通过相对路径。

### 绝对路径

绝对路径即每次 commit 的哈希值，通过 git log 查看。

```bash
git checkout C1 # C1 是简化的哈希值，一般情况下都很长
```

### 相对路径

使用 `^` 和 `~` 来指示要去的地方在 HEAD 上面的第几个节点。

`HEAD^` 是上面一个节点，`HEAD~2` 是上面两个节点。

```bash
git checkout HEAD^ # 回到上一个节点
git checkout HEAD~3 # 回到上 3 个节点
```

HEAD 是一个指向当前所在分支的指针，总是指向当前分支上最近一次提交记录。

## 直接回到历史

到达节点后，如果要用新的分支创建 commit，创建就是了。

如果要用原本的分支，就使用 `git branch -f` 将分支挪过来。

```bash
git branch -f master HEAD^ # 让 master 指向上一个节点
git branch -f master C1 # 让 master 到哈希值为 C1 的节点
```

这个地方注意，如果 *head* 已经分离至需要的节点，只需要使用

```bash
git branch -f master
```

就可以将分支移到 *head* 所在的节点，要记得 *checkout* 到分支上去，不然依然会处于 *head* 分离的状态。

## 创建一个回滚到上一版本的新 commit

这个方法比较能保全记录， revert 到想去的节点，绝对路径相对路径都可以。

```bash
git revert HEAD^
```