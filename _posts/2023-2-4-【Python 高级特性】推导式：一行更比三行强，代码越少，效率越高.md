---
title: 【Python 高级特性】推导式：一行更比三行强，代码越少，效率越高
date: 2024-2-4 12:00 +0800
categories: [Python 高级特性]
tags: [Python, 推导式]
---

Hi 朋友们，我会用一系列文章展示 Python 高级特性，这篇文章是系列的第一篇。Python 高级特性指的是 Python 中一些非常强大的特性，尽管有一些学习成本，但是一旦掌握，将极大提升我们的代码质量。这些特性十分常见，但是很多初学者并不熟悉。因此，我会在这个系列中详细介绍这些特性，希望能帮助你更好地使用 Python。

今天我想要分享的内容是推导式。推导式是一种创建列表或其他可迭代对象的方式，它比常规方法更加有效率。常规方法需要 3 行才能完成的功能，使用推导式仅需要 1 行。

我会在下面的例子中展示，如何构造推导式。你会发现它简单、实用又强大。

让我们开始吧！

## 列表推导式

### 基础使用

第一个例子是最最简单的，仅仅是复制了一个列表。

```python
nums = [0,1,2,3,4,5]

my_list = []
for i in nums:
    my_list.append(i)
print(my_list)
```

首先创建一个新列表，然后使用 `for` 循环遍历原有列表，将原有列表中的每个元素都添加到新列表中。

现在，我将使用列表推导式来完成同样的功能。

```python
my_list = [i for i in nums]
print(my_list)
```

看，原本需要三行才能完成的功能，通过列表推导式，使用一行即可完成。

现在让我们来看一下列表推导式的构造。两边的方括号意味着我们正在构造一个列表，最前面的 `i` 是在列表中生成的元素，而 `i` 具体是什么呢，后面的 `for i in nums` 告诉我们，`i` 是 `nums` 中的每个元素。

这个例子我们可以看到，列表推导式很容易写，很好理解。这是一个非常简单的列表推导式，现在让我们看另一个稍微复杂一点的例子。

### 加入操作

现在，我们需要创建一个新列表，存储原有列表中每个数字的平方。常规的做法是：

```python
nums = [0,1,2,3,4,5]

my_list = []
for i in nums:
    my_list.append(i**2)
print(my_list)
```
创建一个新列表，然后使用 `for` 循环遍历原来列表，将每个元素的平方添加到新列表中。

如果使用列表推导式，可以这样写：

```python
my_list = [i**2 for i in nums]
print(my_list)
```

与上一个例子不同，这次最开始的是 `i**2`，这意味着我们需要在列表中生成 `i` 的平方。后面的 `for i in nums` 与之前的例子一样，意思是对于 `nums` 中的每个 `i`，将 `i` 的平方放到列表中。

让我们继续，看看下一个更复杂一点的例子。

### 加入条件

现在，我只想将列表中偶数平方，而不是每个元素都平方，因此我用到了 `if`。

```python
nums = [0,1,2,3,4,5]

my_list = []
for i in nums:
    if i % 2 == 0:
        my_list.append(i**2)
print(my_list)
```
新建一个列表，然后使用 `for` 循环遍历原有列表，在 `for` 循环中添加 `if`，判断循环的元素是否是偶数，是偶数就将它的平方添加到新列表中。

以下是使用列表推导式的写法。

```python
my_list = [i**2 for i in nums if i % 2 == 0]
print(my_list)
```
相比上一个例子，这个例子在 `for` 循环后添加了 `if` 语句用于判断。但如果我们想加入 `else` 语句，那么 `for` 循环语句需要放在最后面。

我将展示使用列表推导式，将偶数平方，奇数立方的写法。

```python
my_list = [i**2 if i % 2 == 0 else i**3 for i in nums]
```

这个例子中，`for` 循环放在了最后面，`if` 语句放在了前面。尽管这样的写法是合法的，但可读性稍弱。所以，在熟练使用列表推导式之前，我不建议在列表推导式中加入 `else` 语句。

接下来，是一个更复杂的列表推导式。

### 嵌套 loop

现在我想要一个元组组成的列表。这个元组的两个item分别来自两个列表。一个列表是 `['a', 'b', 'c']`，另一个是 `[1, 2, 3]`。也就是说，我希望得到 `[(a1), (a2), (a3), (b1), (b2), (b3), (c1), (c2), (c3)]`这样的列表。

```python
nums = ['a', 'b', 'c']
l2 = [1, 2, 3]

my_list = []
for i in nums:
    for j in l2:
        my_list.append((i, j))
print(my_list)
```
用列表推导式可以这样写：

```python
my_list = [(i, j) for i in nums for j in l2]
print(my_list)
```

这个列表推导式包含两个 `for` 循环，这两个 `for` 的顺序与常规语句是一样的。前面的 `for` 是外循环，里面的 `for` 是内循环。

## 字典推导

除了列表，字典也可以使用推导式。

以下语句展示了如何 for 循环两个列表来创建一个字典。

```python
letters = ['a', 'b', 'c']
nums = [1, 2, 3]

my_dict = {}
for i, j in zip(letters, nums):
    my_dict[i] = j
```
`zip` 函数的功能是将两个列表中的元素一一对应起来，返回一个元组构成的可迭代对象。在这个例子中，`zip` 函数返回的是 `('a', 1), ('b', 2), ('c', 3)`。

上述代码先创建一个空字典，然后使用 `for` 循环遍历每个元组，将元组的第一个元素作为 key，第二个元素作为 value，添加到空字典中。

现在我将使用推导式进行改写。

```python
my_dict = {i:j for i, j in zip(letters, nums)}
```

字典推导与列表推导不同的地方是，一开始需要是 `key:value` 的形式，表示字典中的键值对。如果需要加入条件，与列表推导一样，在 `for` 循环的后面加入 `if` 语句。

```python
d = {i:j for i, j in zip(letters, nums) if j % 2 == 0}
```

## 集合推导

集合是一种相对字典和列表没那么常见的数据类型，特点是无序且不重复。当你想要去除一个列表中的重复元素时，就会用到集合。
集合推导式的写法与列表推导式非常相似，下面的语句根据一个列表新建了一个集合。

```python
l = [1, 2, 3, 4, 5, 5, 5, 6, 6, 7, 8, 9]

my_set = set()
for i in l:
    my_set.add(i)
```

首先创建一个空集合，然后使用 for 循环遍历 l，将每个 item 添加到 my_set 中。

现在我将使用推导式进行改写。

```python
my_set = {i for i in l}
```
与列表推导唯一的不同仅在于将方括号换成了花括号。

## 总结

通过这篇内容，你会惊讶地发现，列表推导式、字典推导式和集合推导式的写法都非常简单，功能也很实用。现在你可以浏览你的代码并用这些推导式来替换一些臃肿的 for 循环，这绝对会使你的代码更上一层楼。
如果你还有其他的问题，欢迎在评论区留言，我会尽快回复。
如果你觉得这篇文章对你有帮助，欢迎点赞分享。也欢迎关注我的频道，我会持续更新 Python 相关的内容。感谢你的观看。