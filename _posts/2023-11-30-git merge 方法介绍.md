---
title: git merge 方法介绍
date: 2023-11-30 21:00:00 +0800
categories: [git]
tags: [git]
---

## git merge 的两种方式

git merge 有两种方式，一种是 *fast-forward* ，一种是 *non-fast-forward*。

以下图为例进行说明，图上有 master 和 dev 两个分支，master 上的节点为每次大的版本更替，而 dev 上为开发过程中琐碎的 commit。现在在 master 分支，需要 merge dev 分支以应用最新的修改。

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/2ed1b44a-7d50-4377-ac9c-db49db66cffb/cbe35df7-641a-4a78-9047-b8217e30b813/Untitled.png)

### *fast-forward*

fast-forward 并不会真正合并，只是移动指针。而且只有当**要合并的分支为当前分支的后代**，才可以使用 *fast-forward* 合并。

在本例中，dev 分支是 master 分支的后代，所以可以使用 *fast-forward*。

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/2ed1b44a-7d50-4377-ac9c-db49db66cffb/1b79fb91-e5b2-4044-939f-20ae7746f1a5/Untitled.png)

*fast-forward* 合并后如图，可以看出并没有实际发生 merge，只是移动了 master 的指针。而之前 dev 的 commit 记录也成为了 master 的。

### *non-fast-forward*

*non-fast-forward* 会产生一个 merge commit，包含 merge 的内容。如下图所示。

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/2ed1b44a-7d50-4377-ac9c-db49db66cffb/d5074850-1227-4877-8a89-974e7bae6f65/Untitled.png)

## git merge 的三个参数

git merge 有三个参数，分别是 `--ff` `--no-ff` `--ff-only`  。

以下面这张图为例说明三个参数的意义，图上有 master 和 dev 两个分支，master 上的节点为每次大的版本更替，而 dev 上为开发过程中琐碎的 commit。现在在 master 分支，需要 merge dev 分支以应用最新的修改。

- `--ff`：可以使用 *fast-forward* 就使用 *fast-forward*，不可以就使用 *non-fast-forward*。
- `--ff-only` ：可以使用 *fast-forward* 就使用 *fast-forward*，不可以就拒绝合并。
- `--no-ff` ：只使用 *non-fast-forward*。

## 日常工作中用什么方法

在上面的例子中提到，*fast-forward* 只移动了指针，而且会将要合并分支的 commit 都继承。这意味着，如果使用这个方法合并 dev，master 分支中会包含大量琐碎的开发 commit，无法维持 git log 的干净清晰。

因此，每次 master merge dev，应该使用 *non-fast-forward。*

### 将配置改为默认 *non-fast-forward*

git merge 默认使用 *fast-forward*，可以通过 git config 改成默认 *non-fast-forward*。

```bash
git config merge.ff false
```

修改配置后，默认 merge 都不是快进合并。需要快进合并时加上参数 `--ff` 。