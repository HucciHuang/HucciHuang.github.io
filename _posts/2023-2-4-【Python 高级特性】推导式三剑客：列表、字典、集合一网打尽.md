---
title: 【Python 高级特性】推导式三剑客：列表、字典、集合一网打尽
date: 2024-1-4 12:00 +0800
categories: [Python 高级特性]
tags: [Python, 推导式]
---

今天我想要分享的内容 Python 中的推导式，
基本来说，推导式是一种更简单，更易读的方式来创建列表或其他可迭代对象。我觉得学习推导式最好的方式是看看它用于for循环的样子。因为每个人都很熟悉for 循环，即使你擅长的是其他语言，也会对for循环非常熟悉。
现在，让我们看看以下例子，我会展示推导式的一些优势，包括他们的有多容易写和多容易读。

对了，这篇文章是我【Python 高级特性】系列的第一篇。Python 高级特性是一些专属于 Python 的强大特性，他们复杂又灵活，尽管有一些学习成本，但是一旦掌握，将极大提升编程效率和代码质量。

让我们开始吧！

## 列表推导式

### 基础使用

第一个例子是最简单的 for 循环，仅仅是复制了一个列表。

```python
nums = [0,1,2,3,4,5]

my_list = []
for i in nums:
    my_list.append(i)
print(my_list)

```

首先创建一个空的列表，然后使用 for 循环遍历 nums，将每个 item 添加到 my_list 中。让我们尝试运行一下，你可以看到结果和我们预想的一致，只是复制了原有的列表。

现在，我将使用列表推导式来完成同样的功能，事实上，列表推导式会和上面的代码长得很像。

```python
my_list = [i for i in nums]
print(my_list)

```

看，原本需要三行才能完成的功能，通过列表推导式，使用一行即可完成。

现在让我们来看一下列表推导式的构造。两边的方括号意味着我们正在构造一个列表。`for ... in` 结构表示这是一个 for 循环，`i` 是循环变量，`nums` 是我们要循环的对象。for 前面的 i 是需要放在列表的东西。

让我们运行看看，结果是完全一样的。而列表推导式更容易写，也更好阅读。

这是一个非常简单的列表推导式，现在让我们看另一个稍微复杂一点的例子。

### 加入操作

现在，我们需要一个新列表，用于存储原有列表中每个数字的平方。

```python
nums = [0,1,2,3,4,5]

my_list = []
for i in nums:
    my_list.append(i**2)
print(my_list)
```
同样创建了一个新列表 `my_list`，然后使用 for 循环遍历 nums，将每个 item 的平方添加到 my_list 中。
现在，我要使用列表推导式来完成同样的功能。

```python
my_list = [i**2 for i in nums]
print(my_list)

```

与上一个例子不同之处是 *for* 前面的部分，用刚刚的解释来理解一下。

> for 前面的 i 是需要放在列表的东西。

这次我们需要的是数字的平方，因此 *for* 前面由原来的 `i` 变成了 `i**2`。

让我们继续，看看下一个更复杂一点的例子。

### 加入条件

我只想将列表中偶数平方，那就会需要用到 if。下面的语句展示了常规写法。

```python
nums = [0,1,2,3,4,5]

my_list = []
for i in nums:
    if i % 2 == 0:
        my_list.append(i**2)
print(my_list)
```
新建一个列表，然后使用 for 循环遍历 nums，使用 if 语句判断是否与2相除的余数是否为 0，如果为 0，就将它的平方添加到 my_list 中。

运行一下，结果与我们预期的一致，只有偶数的平方。

现在，我要用列表推导式写一遍。

```python
my_list = [i**2 for i in nums if i % 2 == 0]
print(my_list)
```

我们可以将这个列表推导式分为三部分理解。`i**2` 是需要放在列表的东西，`for i in nums` 是循环，`if i % 2 == 0` 是条件。意思是，对于 nums 中的每个 i，如果 i 是偶数，就将 i 的平方放到列表中。

接下来，是一个更复杂的列表推导式。

### 嵌套 loop

现在我想要一个元组组成的列表。这个元组的两个item分别来自两个列表。一个列表是 `['a', 'b', 'c']`，另一个是 `[1, 2, 3]`。也就是说，我希望得到 `[(a1), (a2), (a3), (b1), (b2), (b3), (c1), (c2), (c3)]`这样的列表。

```python
nums = ['a', 'b', 'c']
l2 = [1, 2, 3]

my_list = []
for i in nums:
    for j in l2:
        my_list.append((i, j))
print(my_list)

```
运行出来的结果显一样的 
用列表推导式可以这样写：

```python
my_list = [(i, j) for i in nums for j in l2]
print(my_list)

```

这个列表推导式包括两个 for 循环，这两个 for 的顺序与常规语句是一样的。前面的 for 是外面的循环，里面的 for 是内部的循环。

## 字典推导

除了列表，字典也可以使用推导式。

以下语句展示了如何 for 循环两个列表来创建一个字典。

```python
nums = ['a', 'b', 'c']
l2 = [1, 2, 3]

d = {}
for i, j in zip(nums, l2):
    d[i] = j
```
`zip` 函数的功能是将两个列表中的元素一一对应起来，返回一个元组构成的可迭代对象。在这个例子中，`zip` 函数返回的是 `('a', 1), ('b', 2), ('c', 3)`。

上述代码先创建一个空字典 `d`，然后使用 for 循环遍历每个元组，将元组的第一个元素作为 key，第二个元素作为 value，添加到字典 `d` 中。

现在我将使用推导式进行改写。

```python
d = {i:j for i, j in zip(nums, l2)}
```

字典推导与列表推导不同的地方是，`for` 前面是 `key:value`，表示我们需要在字典里放的东西。如果需要加入条件，与列表推导一样，在 for 循环的后面加入 if 语句。

```python
d = {i:j for i, j in zip(nums, l2) if j % 2 == 0}
```

## 集合推导

集合是一种相对字典和列表没那么常见的数据类型，集合的特点是无序且不重复。当你想要去除一个列表中的重复元素时，就会用到集合。
集合推导式的写法与列表推导式类似，下面的语句根据一个列表新建了一个集合。

```python
l = [1, 2, 3, 4, 5, 5, 5, 6, 6, 7, 8, 9]

s = set()
for i in l:
    s.add(i)

```

首先创建一个空集合 `s`，然后使用 for 循环遍历 l，将每个 item 添加到 s 中。现在我将使用推导式进行改写。

```python
s = {i for i in l}
```
与列表推导唯一的不同仅在于将方括号换成了花括号。

## 总结

通过这篇内容，你会惊讶地发现，列表推导式、字典推导式和集合推导式的写法都非常简单，而且非常实用。你可以浏览你的代码并用这些推导式来替换一些臃肿的 for 循环，这绝对会使你的代码更上一层楼。
如果你还有其他的问题，欢迎在评论区留言，我会尽快回复。
如果你觉得这篇文章对你有帮助，欢迎点赞分享。也欢迎关注我的频道，我会持续更新 Python 相关的内容。感谢你的观看。