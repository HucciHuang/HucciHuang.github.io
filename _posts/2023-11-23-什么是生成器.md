---
title: 什么是生成器
date: 2023-11-23 20:00:00 +0800
categories: [Python]
tags: [python, generator]
---

## 生成器是什么

生成器是一个迭代器，特点是每次只生成一个item，不一次性生成所有，以此达到节省内存的目的。

## 定义生成器

生成器可以通过**生成器表达式**和**生成器函数**两种方式定义，下面展示两种方式定义同一个生成器。

### 用生成器表达式定义生成器

```python
nums = [1,2,3,4,5]
my_nums = (i*i for i in nums)
```

### 用生成器函数定义生成器

生成器函数最大的特征是 `yield` 语句，`yield` 会返回一个值，同时，下次再进来的时候会从 `yield` 开始。

```python
def square_nums(nums):
    for i in nums:
        yield i*i

my_nums = square_nums([1,2,3,4,5])
```

## 读取生成器

有两种方式读取生成器，`next` 和 `for` 。

### *next*

一是用 `next` 函数读取下一个元素。

```python
print(next(my_nums, None)) # 1
print(next(my_nums, None)) # 4
print(next(my_nums, None)) # 9
```

不断用 `next` 读取下一个，会在没有下一个可以读取时报错。上面的例子给了第二个参数。在没有下一个的时候返回 None。

### *for*

```python
for _ in my_nums:
    print(_)
```

每次进入 *for* 循环，就相当于执行了一次 *next*。

## 实际案例

我最近需要扫描一个文件中所有后缀是 `.xlsx` 的文件，使用了下面的语句。

```python
file = next((x for x in file_lst if x.endswith(r'.xlsx')), None)
```

其实不算我写出来的，是 GH Copilot 写出来的。算是我第一次实际使用到生成器，记录一下。